# 트랜잭션 처리

<img width="900"  alt="image" src="https://github.com/user-attachments/assets/dee5c34d-f552-4a40-94b0-c32cc9b0e389" />

# 트랙잭션의 4대 특성(ACID)

## 참고사이트
https://engineeringatscale.substack.com/p/acid-properties-databases-explained

---

# 🎬 시나리오: “카페에서 커피 주문하기”

jong이 카페에서 아메리카노를 주문한다고 상상해보자.  
이 상황을 데이터베이스 트랜잭션에 비유하면 아주 쉽게 이해돼.

---

# 🟡 1. **원자성(Atomicity)**  
> “주문은 전부 되거나, 전부 안 되거나 둘 중 하나여야 한다.”

### ✔ 시나리오 예시  
jong이 카페에서 아메리카노를 주문하고 결제를 시도했는데…

- 카드 결제는 성공했지만  
- 바리스타가 주문을 못 받았다면?

이건 말이 안 되지.

그래서 **둘 중 하나만 성공하는 상황은 절대 발생하면 안 돼.**

- 주문 + 결제 → 둘 다 성공해야 주문이 성립  
- 하나라도 실패하면 → 전체 취소(rollback)

👉 **트랜잭션은 “모두 성공 or 모두 실패”만 허용한다.**

---

# 🔵 2. **격리성(Isolation)**  
> “내 주문은 다른 사람 주문과 섞이지 않는다.”

### ✔ 시나리오 예시  
jong이 주문하는 동시에 다른 손님도 주문하고 있다.

하지만:

- jong의 주문이 다른 사람 주문과 섞여서  
- “아메리카노 1잔 + 카페라떼 1잔”이 뒤죽박죽 되면 안 되지.

카페 시스템은 **각 손님의 주문을 독립적으로 처리**해야 한다.

👉 **트랜잭션끼리는 서로 간섭하지 않고 독립적으로 처리된다.**

---

# 🟢 3. **영속성(Durability)**  
> “주문이 완료되면 절대 사라지지 않는다.”

### ✔ 시나리오 예시  
jong이 결제를 완료하고 주문이 접수되었다면:

- 갑자기 카페 POS가 재부팅되더라도  
- 주문 내역이 날아가면 안 된다.

이미 “주문 완료”라고 뜬 순간,  
그 정보는 **영구적으로 저장**되어야 한다.

👉 **commit된 데이터는 시스템이 꺼져도 유지된다.**

---

# 🔴 4. **일관성(Consistency)**  
> “주문 전과 후의 상태가 논리적으로 맞아야 한다.”

### ✔ 시나리오 예시  
카페 재고가 10잔 남았는데 jong이 1잔 주문하면:

- 재고는 9잔이 되어야 한다.

그런데 만약:

- 주문은 들어갔는데 재고가 그대로 10잔이라면?  
- 또는 재고가 8잔으로 줄어버린다면?

이건 시스템 오류다.

👉 **트랜잭션 전후로 데이터는 항상 규칙을 지켜야 한다.**

---

# 🎯 한눈에 보는 ACID 요약

| 특성 | 일상적 의미 | 시나리오 |
|------|-------------|----------|
| **원자성** | 전부 성공 or 전부 실패 | 결제만 되고 주문이 안 되는 상황은 없음 |
| **격리성** | 서로 간섭 없음 | 다른 손님 주문과 섞이지 않음 |
| **영속성** | 저장되면 절대 사라지지 않음 | 주문 완료 후 POS 꺼져도 주문 유지 |
| **일관성** | 규칙이 항상 유지됨 | 재고 10 → 주문 후 9로 정확히 변경 |

---
