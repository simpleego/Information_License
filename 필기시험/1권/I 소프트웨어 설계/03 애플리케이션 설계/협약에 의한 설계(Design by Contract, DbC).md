
# 협약에 의한 설계(Design by Contract, DbC) 
> **협약에 의한 설계(Design by Contract, DbC)** 는 소프트웨어 모듈이 서로 소통할 때, 마치 비즈니스 계약처럼 **'상호 간의 의무와 권리'**를 명확히 정의하여 신뢰성을 높이는 설계 방법론입니다.
> 1986년 버트런드 마이어(Bertrand Meyer)가 에펠(Eiffel) 언어를 만들며 제안했습니다.
> 이 개념은 "만약 당신(호출자)이 **선행조건**을 지켜준다면, 나(피호출자)는 반드시 **결과조건**을 보장하겠다"는 약속입니다.

---

## 1. DbC의 핵심 3요소

### ① 선행조건 (Precondition)

* **의미:** 클라이언트(함수를 사용하는 쪽)가 함수를 호출하기 전에 반드시 만족시켜야 하는 조건입니다.
* **비유:** 은행 대출을 받으려면 신분증과 수입 증빙 서류가 반드시 있어야 하는 것과 같습니다. 서류가 없으면 대출 프로세스(함수)는 시작조차 할 수 없습니다.
* **설계 원칙:** 선행조건이 위반되었다면, 그것은 **호출한 쪽의 버그**입니다.

### ② 결과조건 (Postcondition)

* **의미:** 함수가 실행을 마친 후, 호출자에게 보장해야 하는 상태나 결과 값의 조건입니다.
* **비유:** 대출 심사가 끝났다면, 고객의 통장에는 정확히 약속된 금액이 입금되어 있어야 하고 대출 실행 통보가 완료되어야 합니다.
* **설계 원칙:** 결과조건이 위반되었다면, 그것은 **함수 내부(구현체)의 버그**입니다.

### ③ 불변조건 (Invariant)

* **의미:** 함수 실행 전과 실행 후, 항상 참(True)으로 유지되어야 하는 조건입니다. 클래스의 상태가 일관성을 유지하고 있는지 확인합니다.
* **비유:** 대출 전후로 은행이 보유한 전체 자본금은 (대출금을 제외하고) 항상 양수(+)여야 하며, 은행 시스템의 보안 설정은 변함없이 작동해야 합니다.
* **설계 원칙:** 함수 내부에서 잠시 조건이 깨질 수는 있지만, 호출자에게 제어권이 돌아갈 때는 반드시 복구되어 있어야 합니다.

---

## 2. 예시를 통한 이해: '은행 계좌 인출' 함수

```text
함수명: withdraw(amount)

1. 선행조건 (Precondition)
   - amount > 0 (인출 금액은 양수여야 함)
   - balance >= amount (잔액이 인출 금액보다 많아야 함)

2. 결과조건 (Postcondition)
   - 새로운 잔액 = 이전 잔액 - amount
   - 함수는 실제 인출된 금액을 반환해야 함

3. 불변조건 (Invariant)
   - balance >= 0 (계좌 잔액은 어떤 경우에도 마이너스가 될 수 없음)

```

---

## 3. 왜 협약에 의한 설계를 하는가? (장점)

| 구분 | 설명 |
| --- | --- |
| **명확한 책임** | 문제가 발생했을 때 호출자의 잘못인지, 구현자의 잘못인지 즉시 판별 가능합니다. |
| **자동화된 문서화** | 코드 자체에 계약 내용이 포함되어 있어 별도의 문서 없이도 사용법을 정확히 알 수 있습니다. |
| **견고한 소프트웨어** | 런타임에 조건을 체크하므로 예외 상황을 조기에 발견하여 시스템 붕괴를 막습니다. |
| **디버깅 비용 절감** | 잘못된 데이터가 시스템 깊숙이 들어오기 전에 입구(선행조건)에서 차단합니다. |

---

### 💡 정리하며

> 협약에 의한 설계는 **"방어적 프로그래밍(Defensive Programming)"**과는 조금 다릅니다. 방어적 프로그래밍은 모든 입력값에 대해 일일이 에러 처리를 하는 방식이라면, 
> DbC는 **"계약을 어긴 호출은 처리할 가치가 없다"**고 단정 지어 코드를 더 간결하고 명확하게 만듭니다.
